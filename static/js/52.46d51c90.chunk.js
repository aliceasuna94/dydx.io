(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{2122:function(e,t,a){"use strict";a.d(t,"b",function(){return d}),a.d(t,"c",function(){return u}),a.d(t,"d",function(){return p}),a.d(t,"a",function(){return O});var r=a(4),i=a.n(r),l=a(41),n=a(44),o=a(26),s=a(94),c=a(10);const d=e=>i()(e,"indexPrices.indexPrices"),u=e=>i()(e,"indexPrices.areIndexPricesLoaded"),p=Object(l.a)([n.e,d,o.d],(e,t,a)=>O({pair:e,allIndexPrices:t,allMarkets:a})),O=({pair:e,allIndexPrices:t,allMarkets:a})=>{const r=e.orderMarket,i=e.baseSymbol,l=e.quoteSymbol,n=Object(o.c)({allMarkets:a,symbol:i}),d=Object(o.c)({allMarkets:a,symbol:l}),u=t[r];if(u)return new s.a(u,n,d).getNaturalValue();const p=Object(o.c)({allMarkets:a,symbol:"DAI"});if(p&&p.oraclePrice){if("WETH-DAI"===r){if(t["WETH-USDC"])return new s.a(t["WETH-USDC"],n,Object(o.c)({allMarkets:a,symbol:"USDC"})).getNaturalValue().div(p.oraclePrice)}if("DAI-USDC"===r)return Object(c.a)(p.oraclePrice)}return null}},2461:function(e,t,a){e.exports={editTakeProfitModal:"_3AjxHj5yg_GTveaIfDtfW6",indexArea:"nqoP6m9QQq9bKFuQ5_LHP"}},2513:function(e,t,a){"use strict";a.r(t);var r=a(37),i=a.n(r),l=a(39),n=a.n(l),o=a(0),s=a.n(o),c=a(1),d=a.n(c),u=a(52),p=a(60),O=a(34),g=a(9),P=a.n(g),b=a(74),k=a(79),y=a(2127),m=a(2123),E=a(344),T=a(618),I=a(83),M=a(26),f=a(33),_=a(249),R=a(250),D=a(2122),h=a(44),S=a(11),L=a(21),j=a(65),A=a(5),C=a(170),q=a(94),w=a(46),x=a(103),N=a(2),G=a(2461),V=a.n(G);function asyncGeneratorStep(e,t,a,r,i,l,n){try{var o=e[l](n),s=o.value}catch(c){return void a(c)}o.done?t(s):Promise.resolve(s).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise(function(r,i){var l=e.apply(t,a);function _next(e){asyncGeneratorStep(l,r,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(l,r,i,_next,_throw,"throw",e)}_next(void 0)})}}class v extends o.Component{constructor(e){var t;super(e),t=this,this.onClickCta=_asyncToGenerator(function*(){const e=t.props,a=e.allPairOrderData,r=e.baseMarket,i=e.canBypass28DayRequirement,l=e.cancelOrder,n=e.closeModal,o=e.legacySigning,s=e.placeOrder,c=e.position,d=e.quoteMarket,u=e.stringGetter,p=e.walletAddress,g=e.walletType,b=t.state,k=b.triggerPriceMP,y=b.hasInitialTakeProfit;try{t.setState({isLoading:!0});const e=c.type,n=c.sizeMV,b=c.pair,E=c.accountNumber,T=(a[b.orderMarket]||{}).minimumTickSize,I=e===j.b.ISOLATED_LONG?N.f.SELL:N.f.BUY,M=t.getPositionTakeProfitOrder();if(y&&M&&!k)yield l({pair:b,walletAddress:p,walletType:g,legacySigning:o,orderHash:M.id,orderType:M.orderType});else{const e=n.baseAmount.times(2),t=k.getMarketPriceWithSlippage(S.e,I),l=Object(x.a)({allPairOrderData:a,pair:b,baseMarket:r,quoteMarket:d,amount:e.integerValue(P.a.ROUND_CEIL),side:I,priceMP:t.getMarketPriceRoundedToTickSize(T),triggerPriceMP:k,walletAddress:p,tradeOrderType:S.u.STOP,goodTilDate:new P.a(O.DateTime.local().plus({years:10}).toSeconds()).integerValue(P.a.ROUND_CEIL),timeInForceOption:L.p.FILL_OR_KILL,postOnly:!1,decreaseOnly:!0,accountNumber:new P.a(E),isTakeProfitOrder:!0,isIsolatedOrder:!0}),c=l.order,u=l.fillOrKill,y=l.postOnly;yield s({allPairOrderData:a,pair:b,walletType:g,legacySigning:o,order:c,fillOrKill:u,postOnly:y,setExpirationOnFill:!i,isTakeProfitOrder:!0,triggerPriceMP:k,cancelOrderId:M&&M.id})}}catch(m){let e;Object(C.e)(m)&&(e=u({key:A.a.CLOSE_COLLATERALIZATION}));const a=Object(C.j)({error:m,walletAddress:p,walletType:g,location:"edit-stop-modal",notifyBugsnag:!e,stringGetter:u}).message;return void t.setState({isLoading:!1,error:e||a})}n()}),this.onClickClear=(()=>this.setState({triggerPriceMP:null,triggerPriceInputValue:"",error:null})),this.onChangeInput=((e,t)=>{if(e&&e.isZero())return void this.setState({error:null,triggerPriceMP:null,triggerPriceInputValue:t});const a=this.props,r=a.allIndexPrices,i=a.allMarkets,l=a.position,n=l.type,o=l.pair,s=a.baseMarket,c=a.quoteMarket,d=a.stringGetter,u=Object(w.a)(e,c.currency.decimals).dp(o.tickDecimals),p=q.a.fromNaturalValue(u,s,c),O=Object(D.a)({pair:o,allMarkets:i,allIndexPrices:r});let g;n===j.b.ISOLATED_LONG?u.lte(O)&&(g=d({key:A.a.TAKE_PROFIT_MUST_ABOVE_INDEX})):n===j.b.ISOLATED_SHORT&&u.gte(O)&&(g=d({key:A.a.TAKE_PROFIT_MUST_BELOW_INDEX})),this.setState({error:e&&e.gt(0)&&g,triggerPriceMP:p,triggerPriceInputValue:u.toFixed(o.tickDecimals)})});const a=e.position.pair,r=e.baseMarket,i=e.quoteMarket;let l="",n=null,o=!1;const s=this.getPositionTakeProfitOrder();s&&(l=(n=new q.a(new P.a(s.triggerPrice),r,i)).getNaturalValue().toFixed(a.tickDecimals),o=!0),this.state={isLoading:!1,triggerPriceInputValue:l,triggerPriceMP:n,hasInitialTakeProfit:o,initialPriceMP:n}}isCloseEnabled(){return!this.state.error&&this.isAmountValid()}getPositionTakeProfitOrder(){const e=this.props,t=e.position.accountNumber,a=e.allOrders,r=Object(_.b)(a,t);return n()(r)>0?i()(r,e=>e.orderType===L.n.CANONICAL_ISOLATED_TAKE_PROFIT):null}render(){const e=this.props,t=e.allIndexPrices,a=e.allMarkets,r=e.baseMarket,i=e.closeModal,l=e.isPairOrderDataLoaded,n=e.position,o=n.type,c=n.liquidationPriceMP,d=n.openPriceMP,u=n.pair,p=e.quoteMarket,O=e.stringGetter,g=this.state,P=g.error,b=g.hasInitialTakeProfit,I=g.initialPriceMP,M=g.isLoading,f=g.triggerPriceInputValue,_=g.triggerPriceMP,R=u.tickDecimals,h=u.baseSymbol,S=c.getNaturalValue().toFixed(R);let L=O({key:A.a.ADD_TRIGGER});b&&(L=O(""===f?{key:A.a.REMOVE_TRIGGER}:{key:A.a.EDIT_TRIGGER}));const C=!!P||!b&&!_||b&&_&&I.baseAmount.eq(_.baseAmount),q=Object(D.a)({pair:u,allMarkets:a,allIndexPrices:t});return s.a.createElement("div",{className:V.a.editTakeProfitModal},s.a.createElement(E.c,null,s.a.createElement(k.d,null,O({key:A.a.EDIT_TAKE_PROFIT_MODAL_TITLE})),s.a.createElement(y.c,{size:y.a.MEDIUM,label:s.a.createElement(m.a,{top:8,left:-32,tooltip:"positions-take-profit-price",stringParams:{SYMBOL:r&&r.symbol}},O({key:A.a.TRIGGER_PRICE}))},s.a.createElement(T.a,{noMargins:!0,market:p,disabled:M||!l,value:f,onClickClear:b?this.onClickClear:null,onChange:this.onChangeInput,placeholder:b?O({key:A.a.REMOVE_TRIGGER}):"0.0000"})),s.a.createElement(k.b,{className:V.a.indexArea},s.a.createElement(k.g,{title:s.a.createElement(m.a,{top:12,left:-32,tooltip:"index-price"},O({key:A.a.INDEX_PRICE}))},q.toFixed(R)," ",p.symbol)),s.a.createElement(k.i,null,s.a.createElement(k.h,null,s.a.createElement(k.g,{title:s.a.createElement(m.a,{top:12,left:-32,tooltip:"positions-open-price"},O({key:A.a.OPEN_PRICE}))},d.getNaturalValue().toFixed(R)," ",p.symbol)),s.a.createElement(k.h,null,s.a.createElement(k.g,{title:s.a.createElement(m.a,{top:12,left:-108,tooltip:o===j.b.ISOLATED_LONG?"liquidation-price-long":"liquidation-price-short",stringParams:{SYMBOL:h}},O({key:A.a.LIQUIDATION_PRICE_SHORT}))},S," ",p.symbol))),P?s.a.createElement(k.a,null,P):null),s.a.createElement(E.b,null,s.a.createElement(E.a,{onClick:i},O({key:A.a.CANCEL})),s.a.createElement(E.a,{disabled:C||M||!l,onClick:this.onClickCta,green:!0,loading:M||!l},L)))}}v.propTypes={allIndexPrices:d.a.object.isRequired,allMarkets:d.a.array.isRequired,allOrders:d.a.array.isRequired,allPairOrderData:d.a.object.isRequired,baseMarket:d.a.object.isRequired,canBypass28DayRequirement:d.a.bool.isRequired,cancelOrder:d.a.func.isRequired,closeModal:d.a.func.isRequired,isPairOrderDataLoaded:d.a.bool.isRequired,legacySigning:d.a.bool,placeOrder:d.a.func.isRequired,position:d.a.object.isRequired,quoteMarket:d.a.object.isRequired,stringGetter:d.a.func.isRequired,walletAddress:d.a.string,walletType:d.a.string};var F=Object(b.k)(Object(u.c)((e,t)=>{const a=t.position.pair,r=Object(M.f)(e,a.baseMarket),i=Object(M.f)(e,a.quoteMarket);return{allIndexPrices:Object(D.b)(e),allMarkets:Object(M.d)(e),allOrders:Object(_.k)(e),allPairOrderData:Object(h.c)(e),baseMarket:r,canBypass28DayRequirement:Object(R.a)(e),isPairOrderDataLoaded:Object(h.f)(e),legacySigning:Object(f.i)(e),quoteMarket:i,walletAddress:Object(f.m)(e),walletType:Object(f.q)(e)}},e=>Object(p.b)({placeOrder:I.c,cancelOrder:I.a},e))(v));a.d(t,"default",function(){return F})}}]);