(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{2122:function(e,t,r){"use strict";r.d(t,"b",function(){return u}),r.d(t,"c",function(){return d}),r.d(t,"d",function(){return p}),r.d(t,"a",function(){return b});var a=r(4),n=r.n(a),i=r(41),s=r(44),o=r(26),l=r(94),c=r(10);const u=e=>n()(e,"indexPrices.indexPrices"),d=e=>n()(e,"indexPrices.areIndexPricesLoaded"),p=Object(i.a)([s.e,u,o.d],(e,t,r)=>b({pair:e,allIndexPrices:t,allMarkets:r})),b=({pair:e,allIndexPrices:t,allMarkets:r})=>{const a=e.orderMarket,n=e.baseSymbol,i=e.quoteSymbol,s=Object(o.c)({allMarkets:r,symbol:n}),u=Object(o.c)({allMarkets:r,symbol:i}),d=t[a];if(d)return new l.a(d,s,u).getNaturalValue();const p=Object(o.c)({allMarkets:r,symbol:"DAI"});if(p&&p.oraclePrice){if("WETH-DAI"===a){if(t["WETH-USDC"])return new l.a(t["WETH-USDC"],s,Object(o.c)({allMarkets:r,symbol:"USDC"})).getNaturalValue().div(p.oraclePrice)}if("DAI-USDC"===a)return Object(c.a)(p.oraclePrice)}return null}},2184:function(e,t,r){"use strict";var a=r(79);r.d(t,"g",function(){return a.h}),r.d(t,"h",function(){return a.i}),r.d(t,"f",function(){return a.g}),r.d(t,"c",function(){return a.d}),r.d(t,"d",function(){return a.e}),r.d(t,"b",function(){return a.b}),r.d(t,"a",function(){return a.a}),r.d(t,"e",function(){return a.f})},2456:function(e,t,r){e.exports={closePerpetualModal:"_3Meh5I4T7WSr669FMinINn",breakTitle:"StpGMFAXcTvcMyUKwDkUE",title:"_3nbtAW01zr6wqnpv3piudN",amountArea:"_1b-eU_df6H3lXuQQ7KkkVq",feeLineItem:"_2bh-9f4K2UWyc42U2CRHdW",badge:"_2EmTjFc_1Ydga8oSjHDlc2",red:"_3kP5nrKt-s94M-SeV_63vh"}},2506:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),i=r(1),s=r.n(i),o=r(52),l=r(60),c=r(230),u=r.n(c),d=r(19),p=r.n(d),b=r(2184),m=r(74),g=r(617),O=r(344),P=r(618),k=r(83),y=r(132),f=r(296),M=r(26),h=r(33),E=r(44),S=r(2122),j=r(11),I=r(61),T=r(5),v=r(57),D=r(301),w=r(46),A=r(191),_=r(10),N=r(170),L=r(103),x=r(615),R=r(2),C=r(2456),B=r.n(C);function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,a)}return r}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function asyncGeneratorStep(e,t,r,a,n,i,s){try{var o=e[i](s),l=o.value}catch(c){return void r(c)}o.done?t(l):Promise.resolve(l).then(a,n)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(a,n){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,a,n,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,a,n,_next,_throw,"throw",e)}_next(void 0)})}}const q=(e,t)=>t?e.lt(0)?R.f.SELL:R.f.BUY:e.gt(0)?R.f.SELL:R.f.BUY;class G extends a.Component{constructor(e){var t;super(e),t=this,this.onClickMax=(()=>{const e=this.props,t=e.allPairOrderData,r=e.currentPair.orderMarket,a=e.stringGetter,n=(t[r]||{}).minimumOrderSize,i=this.getPositionData(),s=i.positionMV,o=i.positionBN,l=i.baseMarket,c=s.getNaturalTokenString(),u=this.getMarketPrice(o),d=Object(w.a)(n,l.currency.decimals);let p=null;u?s.baseAmount.lt(n)&&(p=a({key:T.a.MIN_ORDER_SIZE,params:{SIZE:d,SYMBOL:l.symbol}})):p=a({key:T.a.SPOT_LIQUIDITY}),this.setState({amount:s.baseAmount,inputValue:c,error:p})}),this.onPlaceOrder=_asyncToGenerator(function*(){const e=t.props,r=e.allPairOrderData,a=e.closeModal,n=e.currentPair,i=e.legacySigning,s=e.placeCrossOrder,o=e.stringGetter,l=e.walletAddress,c=e.walletType,u=t.state.amount,d=n.isInversePerpetual;t.setState({isLoading:!0});const p=t.getPositionData(),b=p.positionBN,m=p.baseMarket,g=p.quoteMarket,O=t.getMarketPrice(),P=q(b,d),k=Object(L.a)({allPairOrderData:r,pair:n,baseMarket:m,quoteMarket:g,amount:u,side:P,priceMP:O.getMarketPriceWithSlippage(j.d,P),walletAddress:l,tradeOrderType:j.u.MARKET}),y=k.order,f=k.fillOrKill;try{yield s({allPairOrderData:r,pair:n,walletType:c,legacySigning:i,order:y,fillOrKill:f})}catch(M){let e;const r=Object(N.j)({error:M,walletAddress:l,walletType:c,location:"close-perpetual-modal",notifyBugsnag:!e,stringGetter:o}).message;return void t.setState({isLoading:!1,error:e||r})}a()}),this.onChangeInput=((e,t)=>{const r=this.props,a=r.currentPair,n=a.minOrderSize,i=a.isInversePerpetual,s=r.stringGetter,o=this.getPositionData(),l=o.baseMarket,c=o.quoteMarket,u=o.positionBN,d=i?c:l,p=Object(w.a)(n,d.currency.decimals);let b=null;!this.getMarketPrice(e)&&e&&e.gt(0)?b=s({key:T.a.SPOT_LIQUIDITY}):e.lt(n)?b=s({key:T.a.MIN_ORDER_SIZE,params:{SIZE:p,SYMBOL:d.symbol}}):u.lt(e)&&(b=s({key:T.a.PERPETUAL_CLOSE_GT_POSITION})),this.setState({amount:e,inputValue:t,error:b})}),this.state={isLoading:!1,inputValue:"",error:null,amount:R.a.ZERO}}componentDidMount(){this.onClickMax()}getPositionData(){const e=this.props,t=e.allMarkets,r=e.currentPair,a=r.orderMarket,n=r.baseSymbol,i=r.quoteSymbol,s=r.isInversePerpetual,o=e.perpetualBalances[a],l=o.margin,c=o.position,u=o.pendingMargin,d=o.pendingPosition,p=Object(M.c)({allMarkets:t,symbol:n}),b=Object(M.c)({allMarkets:t,symbol:i}),m=Object(_.a)(c).plus(d),g=new v.a(m.abs(),s?b:p);return{baseMarket:p,quoteMarket:b,positionBN:m,positionMV:g,marginBN:Object(_.a)(l).plus(u)}}getIsAmountValid(){const e=this.getPositionData().positionBN,t=this.state.amount;return e.abs().gte(t)&&t.gt(0)}getMarketPrice(e){const t=this.props,r=t.allOrderbookOrders,a=t.allMarkets,n=t.currentPair,i=this.state.amount,s=this.getPositionData().positionBN,o=n.isInversePerpetual;return Object(y.a)({allOrderbookOrders:r,allMarkets:a,pair:n,side:q(s,o),amount:e||i})}getBestOrderPrice(){const e=this.props,t=e.allOrderbookOrders,r=e.currentPair,a=this.getPositionData().positionBN,n=r.isInversePerpetual;return Object(y.c)({allOrderbookOrders:t,pair:r,side:q(a,n)})}renderLeverage(){const e=this.props,t=e.allIndexPrices,r=e.currentPair,a=r.orderMarket,i=r.isInversePerpetual,s=e.stringGetter,o=this.state.amount,l=this.getPositionData(),c=l.positionBN,u=l.marginBN,d=this.getMarketPrice(),p=t[a],m=Object(x.c)({positionBN:c,marginBN:u,indexPrice:p,isInversePerpetual:i});let O,P,k;if(d){const e=i?o.div(d.baseAmount):o.times(d.baseAmount),t=Object(x.c)({positionBN:c.gt(0)?c.minus(o):c.plus(o),marginBN:c.gt(0)?u.plus(e):u.minus(e),indexPrice:p,isInversePerpetual:i}),r=o&&o.lte(c.abs());(k=o&&o.gt(0))&&(P=r?"green":"grey",O=r&&t.gt(0)?`${t.toFixed(I.e)}X`:"-")}return n.a.createElement(b.f,{title:s({key:T.a.LEVERAGE})},n.a.createElement(g.b,{afterText:k&&O,arrow:P},`${m.toFixed(I.e)}X`))}renderPriceImpact(){const e=this.props.stringGetter,t=this.getMarketPrice(),r=this.getBestOrderPrice(),a=e({key:T.a.PRICE_IMPACT});if(!t||!r||!this.getIsAmountValid())return n.a.createElement(b.f,{title:a},"\u2014");const i=Object(_.a)(t.baseAmount).minus(r).div(r),s=`${i.times(100).toFixed(I.k)}%`,o=i.gte(j.r);return n.a.createElement(b.f,{red:o,title:a},s)}renderFeeAreas(){const e=this.props,t=e.allPairOrderData,r=e.currentPair,i=e.stringGetter,s=e.walletAddress,o=this.state.amount,l=r.isInversePerpetual,c=this.getPositionData(),u=c.baseMarket,d=c.quoteMarket,m=this.getMarketPrice(),g=l?u:d;let O,P;m&&o&&!o.isZero()&&(O=Object(D.b)({allPairOrderData:t,walletAddress:s,pair:r,amount:o,priceMP:m,tradeOrderType:j.u.MARKET}));let k="-";if(O){P=O.isZero()?"FREE":`${O.times(100).toFixed(I.m)}%`;const e=l?o.div(m.baseAmount):o.times(m.baseAmount);k=`\u2248 ${Object(A.e)(e.times(O),g.currency.decimals)} ${g.symbol}`}return n.a.createElement(a.Fragment,null,n.a.createElement(b.g,null,n.a.createElement(b.f,{className:B.a.breakTitle,title:i({key:T.a.FEE})},n.a.createElement("div",{className:B.a.feeLineItem},k,P&&n.a.createElement("div",{className:p()(B.a.badge,{[B.a.red]:O&&O.gt(j.h)})},P)))))}render(){const e=this.props,t=e.closeModal,r=e.currentPair,a=r.marketName,i=r.tickDecimals,s=r.displayQuoteSymbol,o=r.isInversePerpetual,l=e.isPairOrderDataLoaded,c=e.stringGetter,d=this.state,m=d.inputValue,k=d.amount,y=d.isLoading,f=d.error,M=this.getPositionData(),h=M.baseMarket,E=M.quoteMarket,S=M.positionMV,j=o?function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},E,{symbol:s}):h,I=S.getNaturalTokenString(),D=new v.a(S.baseAmount.minus(k),j),w=D.getNaturalTokenString(),A=this.getMarketPrice();let _;A&&(_=A.getNaturalValue().toFixed(i));const N=k.gt(0);return n.a.createElement("div",{className:B.a.closePerpetualModal},n.a.createElement(O.c,null,n.a.createElement(b.c,null,S.baseAmount.gt(0)?c({key:T.a.CLOSE_MODAL_TITLE_LONG,params:{MARKET:a}}):c({key:T.a.CLOSE_MODAL_TITLE_SHORT,params:{MARKET:a}})),n.a.createElement(b.e,{subtext:c({key:T.a.MARKET_PRICE_SYMBOL,params:{SYMBOL:a}})},_?n.a.createElement(u.a,{thousandSeparator:!0,displayType:"text",value:_,suffix:` ${s}`}):`- ${s}`),n.a.createElement(b.b,{className:B.a.amountArea},n.a.createElement(b.f,{title:c({key:T.a.POSITION_AMOUNT})},n.a.createElement(g.b,{afterText:N&&n.a.createElement("div",{className:p()({[B.a.red]:D.baseAmount.lt(0)})},w),arrow:N&&"red"},I))),n.a.createElement(P.a,{market:j,onClickMax:this.onClickMax,disabled:y||!l,value:m,onChange:this.onChangeInput}),n.a.createElement(b.h,null,n.a.createElement(b.g,null,this.renderLeverage()),n.a.createElement(b.g,null,this.renderPriceImpact())),n.a.createElement(b.h,null,this.renderFeeAreas()),f?n.a.createElement(b.a,null,f):null),n.a.createElement(O.b,null,n.a.createElement(O.a,{onClick:t},c({key:T.a.CANCEL})),n.a.createElement(O.a,{disabled:!!f||!this.getIsAmountValid(),onClick:this.onPlaceOrder,green:!0,loading:y||!l},c({key:T.a.CLOSE_POSITION}))))}}G.propTypes={allIndexPrices:s.a.object.isRequired,allMarkets:s.a.array.isRequired,allOrderbookOrders:s.a.object.isRequired,allPairOrderData:s.a.object.isRequired,closeModal:s.a.func.isRequired,currentPair:s.a.object.isRequired,isPairOrderDataLoaded:s.a.bool.isRequired,legacySigning:s.a.bool.isRequired,perpetualBalances:s.a.object.isRequired,placeCrossOrder:s.a.func.isRequired,stringGetter:s.a.func.isRequired,walletAddress:s.a.string,walletType:s.a.string.isRequired};var V=Object(m.k)(Object(o.c)(e=>({allIndexPrices:Object(S.b)(e),allMarkets:Object(M.d)(e),allOrderbookOrders:Object(y.d)(e),allPairOrderData:Object(E.c)(e),currentPair:Object(E.e)(e),isPairOrderDataLoaded:Object(E.f)(e),legacySigning:Object(h.i)(e),perpetualBalances:Object(f.e)(e),walletAddress:Object(h.m)(e),walletType:Object(h.q)(e)}),e=>Object(l.b)({placeCrossOrder:k.c},e))(G));r.d(t,"default",function(){return V})}}]);