(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{2122:function(e,t,a){"use strict";a.d(t,"b",function(){return d}),a.d(t,"c",function(){return p}),a.d(t,"d",function(){return g}),a.d(t,"a",function(){return u});var r=a(4),i=a.n(r),l=a(41),n=a(44),o=a(26),s=a(94),c=a(10);const d=e=>i()(e,"indexPrices.indexPrices"),p=e=>i()(e,"indexPrices.areIndexPricesLoaded"),g=Object(l.a)([n.e,d,o.d],(e,t,a)=>u({pair:e,allIndexPrices:t,allMarkets:a})),u=({pair:e,allIndexPrices:t,allMarkets:a})=>{const r=e.orderMarket,i=e.baseSymbol,l=e.quoteSymbol,n=Object(o.c)({allMarkets:a,symbol:i}),d=Object(o.c)({allMarkets:a,symbol:l}),p=t[r];if(p)return new s.a(p,n,d).getNaturalValue();const g=Object(o.c)({allMarkets:a,symbol:"DAI"});if(g&&g.oraclePrice){if("WETH-DAI"===r){if(t["WETH-USDC"])return new s.a(t["WETH-USDC"],n,Object(o.c)({allMarkets:a,symbol:"USDC"})).getNaturalValue().div(g.oraclePrice)}if("DAI-USDC"===r)return Object(c.a)(g.oraclePrice)}return null}},2150:function(e,t,a){e.exports={animatedToggle:"_2uX6PC8cA8YPCtdcDGUDVn",toggled:"_3NWbtL9arP0Eum-jEVhUtn",grayscale:"_4TrMjUnhys9QgRpb_qejA",label:"_3pd4To_unYOQ9_wOU2cXJO",compact:"_2cnM-EVr5tBuRyrxovo9uS"}},2153:function(e,t,a){"use strict";var r=a(0),i=a.n(r),l=a(1),n=a.n(l),o=a(19),s=a.n(o),c=a(2150),d=a.n(c);const p=({className:e,compact:t,grayscale:a,isToggledRight:r,leftLabel:l,onClickLeft:n,onClickRight:o,rightLabel:c})=>i.a.createElement("div",{className:s()(d.a.animatedToggle,{[d.a.toggled]:r,[d.a.grayscale]:a,[d.a.compact]:t},e)},i.a.createElement("div",{role:"button",tabIndex:0,className:d.a.label,onClick:n},l),i.a.createElement("div",{role:"button",tabIndex:0,className:d.a.label,onClick:o},c));p.propTypes={className:n.a.string,compact:n.a.bool,grayscale:n.a.bool,isToggledRight:n.a.bool,leftLabel:n.a.oneOfType([n.a.string,n.a.node]).isRequired,onClickLeft:n.a.func.isRequired,onClickRight:n.a.func.isRequired,rightLabel:n.a.oneOfType([n.a.string,n.a.node]).isRequired};var g=p;a.d(t,"a",function(){return g})},2459:function(e,t,a){e.exports={formTitle:"_1U5RsrXNrmyVK3K-tNxNTP",title:"_3-lndOreVdqBpg3Erpzxzl",subtitle:"_3LPtEYRPXSdoVc_98KAQad"}},2460:function(e,t,a){e.exports={editStopModal:"_30IFa04rfGTd6-7rXznDMJ",indexArea:"_2Ef7IYfmMAXob9QLlZfIUD",trailingStopArea:"_2Ft3v4StnbEp3BjIB4MEsA",toggle:"q-YbtEbxEJfPWy_bN3QJ3",trailingToggleWrapper:"_3WEp6q4s8yzO4SW5fbEWd0",helpIcon:"_25nmgKKHcykCEQtt1Xyi1v",trailingToggleLabel:"_3uxiwb2CqBvyFyLkZ6Dxoa"}},2503:function(e,t,a){"use strict";a.r(t);var r=a(37),i=a.n(r),l=a(39),n=a.n(l),o=a(0),s=a.n(o),c=a(1),d=a.n(c),p=a(52),g=a(60),u=a(34),O=a(9),b=a.n(O),P=a(74),S=a(79),m=a(2459),E=a.n(m);const T=({title:e,subtitle:t})=>s.a.createElement("div",{className:E.a.formTitle},s.a.createElement("div",{className:E.a.title},e),t&&s.a.createElement("div",{className:E.a.subtitle},t));T.propTypes={title:d.a.string.isRequired,subtitle:d.a.string};var y=T,k=a(2153),_=a(2127),I=a(2123),f=a(344),L=a(618),h=a(83),M=a(26),D=a(33),C=a(249),N=a(250),R=a(2122),j=a(44),A=a(11),x=a(21),q=a(61),v=a(65),w=a(5),V=a(94),G=a(170),U=a(46),B=a(103),F=a(2),W=a(10),Q=a(2460),Y=a.n(Q);function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(a,!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(a).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function asyncGeneratorStep(e,t,a,r,i,l,n){try{var o=e[l](n),s=o.value}catch(c){return void a(c)}o.done?t(s):Promise.resolve(s).then(r,i)}function _asyncToGenerator(e){return function(){var t=this,a=arguments;return new Promise(function(r,i){var l=e.apply(t,a);function _next(e){asyncGeneratorStep(l,r,i,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(l,r,i,_next,_throw,"throw",e)}_next(void 0)})}}const K=new b.a(.05),z={error:null,triggerPriceMP:null,triggerPriceInputValue:"",trailingPercent:null};class H extends o.Component{constructor(e){var t;super(e),t=this,this.onClickCta=_asyncToGenerator(function*(){const e=t.props,a=e.allPairOrderData,r=e.position,i=e.baseMarket,l=e.canBypass28DayRequirement,n=e.cancelOrder,o=e.closeModal,s=e.legacySigning,c=e.placeOrder,d=e.quoteMarket,p=e.stringGetter,g=e.walletAddress,O=e.walletType,P=t.state,S=P.triggerPriceMP,m=P.hasInitialStop,E=P.isTrailingStopOrder,T=P.trailingPercent;try{t.setState({isLoading:!0});const e=r.type,o=r.sizeMV,P=r.pair,k=r.accountNumber,_=(a[P.orderMarket]||{}).minimumTickSize,I=e===v.b.ISOLATED_LONG?F.f.SELL:F.f.BUY,f=t.getPositionStopOrder();if(m&&f&&!S)yield n({pair:P,walletAddress:g,walletType:O,legacySigning:s,orderHash:f.id,orderType:f.orderType});else{const t=o.baseAmount.times(2),r=S.getMarketPriceWithSlippage(A.e,I),n=Object(B.a)({allPairOrderData:a,pair:P,baseMarket:i,quoteMarket:d,amount:t.integerValue(b.a.ROUND_CEIL),side:I,priceMP:r.getMarketPriceRoundedToTickSize(_),triggerPriceMP:S,walletAddress:g,tradeOrderType:A.u.STOP,goodTilDate:new b.a(u.DateTime.local().plus({years:10}).toSeconds()).integerValue(b.a.ROUND_CEIL),timeInForceOption:x.p.FILL_OR_KILL,postOnly:!1,decreaseOnly:!0,accountNumber:new b.a(k),isTrailingStopOrder:E,isIsolatedOrder:!0}),p=n.order,m=n.fillOrKill,y=n.postOnly;yield c({allPairOrderData:a,pair:P,walletType:O,legacySigning:s,order:p,fillOrKill:m,postOnly:y,setExpirationOnFill:!l,isStopOrder:!E,isTrailingStopOrder:E,triggerPriceMP:S,trailingPercent:E&&(e===v.b.ISOLATED_LONG?T.negated():T),cancelOrderId:f&&f.id})}}catch(y){let e;Object(G.e)(y)&&(e=p({key:w.a.CLOSE_COLLATERALIZATION}));const a=Object(G.j)({error:y,walletAddress:g,walletType:O,location:"edit-stop-modal",notifyBugsnag:!e,stringGetter:p}).message;return void t.setState({isLoading:!1,error:e||a})}o()}),this.onClickClear=(()=>this.setState(_objectSpread({},z))),this.onClickStandardStop=(()=>{const e=this.props.position.pair.tickDecimals,t=this.state,a=t.initialTrailingPercent,r=t.initialTriggerMP,i=t.isTrailingStopOrder,l=t.isStopDisabled;if(!i)return;if(l)return void this.setState({isTrailingStopOrder:!1});const n=_objectSpread({},z,{isTrailingStopOrder:!1});!a&&r&&(n.triggerPriceMP=r,n.triggerPriceInputValue=r.getNaturalValue().toFixed(e)),this.setState(n)}),this.onClickTrailingStop=(()=>{const e=this.state,t=e.initialTrailingPercent,a=e.isTrailingStopOrder,r=e.isStopDisabled;if(a)return;if(r)return void this.setState({isTrailingStopOrder:!0});const i=_objectSpread({},z,{isTrailingStopOrder:!0});t&&(i.trailingPercent=t),this.setState(i)}),this.onChangeStopPriceInput=((e,t)=>{if(e&&e.isZero())return void this.setState(_objectSpread({},z,{triggerPriceInputValue:t}));const a=this.props,r=a.allIndexPrices,i=a.allMarkets,l=a.position,n=l.type,o=l.pair,s=l.liquidationPriceMP,c=a.baseMarket,d=a.quoteMarket,p=a.stringGetter,g=s.getMarketPriceWithSlippage(K,n===v.b.ISOLATED_LONG?F.f.BUY:F.f.SELL),u=Object(U.a)(e,d.currency.decimals).dp(o.tickDecimals),O=V.a.fromNaturalValue(u,c,d),b=Object(R.a)({pair:o,allMarkets:i,allIndexPrices:r}),P=g.getNaturalValue(),S=P.toFixed(o.tickDecimals),m=b.toFixed(o.tickDecimals);let E;n===v.b.ISOLATED_LONG?(u.gt(b)||u.lt(P))&&(E=p({key:w.a.STOP_CLOSE_TO_LIQ,params:{STOP_LOWER_BOUND:S,STOP_UPPER_BOUND:m}})):n===v.b.ISOLATED_SHORT&&(u.lt(b)||u.gt(P))&&(E=p({key:w.a.STOP_CLOSE_TO_LIQ,params:{STOP_LOWER_BOUND:m,STOP_UPPER_BOUND:S}})),this.setState({error:e&&e.gt(0)&&E,triggerPriceMP:O,triggerPriceInputValue:u.toFixed(o.tickDecimals)})}),this.onChangeTrailingPercentInput=(e=>{if(e&&e.isZero())return void this.setState(_objectSpread({},z,{trailingPercent:""}));const t=this.props,a=t.allIndexPrices,r=t.allMarkets,i=t.position,l=i.type,n=i.pair,o=i.liquidationPriceMP,s=t.baseMarket,c=t.quoteMarket,d=t.stringGetter,p=Object(R.a)({pair:n,allMarkets:r,allIndexPrices:a}),g=l===v.b.ISOLATED_LONG?e.negated():e,u=p.times(g.shiftedBy(-2).plus(1)),O=V.a.fromNaturalValue(u,s,c),b=o.getMarketPriceWithSlippage(K,l===v.b.ISOLATED_LONG?F.f.BUY:F.f.SELL).getNaturalValue();let P;l===v.b.ISOLATED_LONG?(u.gt(p)||u.lt(b))&&(P=d({key:w.a.TRAILING_STOP_CLOSE_TO_LIQ,params:{PERCENT:b.div(p).minus(1).abs().times(100).toFixed(q.k)}})):l===v.b.ISOLATED_SHORT&&(u.lt(p)||u.gt(b))&&(P=d({key:w.a.TRAILING_STOP_CLOSE_TO_LIQ,params:{PERCENT:b.div(p).minus(1).abs().times(100).toFixed(q.k)}})),this.setState({error:P,trailingPercent:e,triggerPriceMP:O})});const a=e.allIndexPrices,r=e.allMarkets,i=e.position,l=i.type,n=i.pair,o=i.liquidationPriceMP,s=e.baseMarket,c=e.quoteMarket,d=e.stringGetter,p=Object(R.a)({pair:n,allMarkets:r,allIndexPrices:a});let g="",O=null,P=null,S=!1,m=!1;const E=this.getPositionStopOrder();if(E){const e=E.triggerPrice,t=E.trailingPercent;S=!0,O=new V.a(new b.a(e),s,c),t?(P=Object(W.a)(t).abs(),m=!0):g=O.getNaturalValue().toFixed(n.tickDecimals)}const T=o.getMarketPriceWithSlippage(K,l===v.b.ISOLATED_LONG?F.f.BUY:F.f.SELL);let y=null,k=!1;l===v.b.ISOLATED_LONG?T.getNaturalValue().gt(p)&&(y=d({key:w.a.LIQ_CLOSE_TO_ORACLE}),k=!0):l===v.b.ISOLATED_SHORT&&T.getNaturalValue().lt(p)&&(y=d({key:w.a.LIQ_CLOSE_TO_ORACLE}),k=!0),this.state={isLoading:!1,error:y,triggerPriceInputValue:g,triggerPriceMP:O,initialTriggerMP:O,trailingPercent:P,initialTrailingPercent:P,hasInitialStop:S,isTrailingStopOrder:m,isStopDisabled:k}}isCloseEnabled(){return!this.state.error&&this.isAmountValid()}getPositionStopOrder(){const e=this.props,t=e.position.accountNumber,a=e.allOrders,r=Object(C.b)(a,t);return n()(r)>0?i()(r,e=>e.orderType===x.n.CANONICAL_ISOLATED_STOP_LIMIT):null}renderInput(){const e=this.props,t=e.isPairOrderDataLoaded,a=e.position.pair,r=e.quoteMarket,i=e.stringGetter,l=this.state,n=l.hasInitialStop,o=l.isLoading,c=l.isStopDisabled,d=l.isTrailingStopOrder,p=l.triggerPriceInputValue,g=l.trailingPercent,u=l.initialTrailingPercent,O=a.baseSymbol;return d?s.a.createElement(_.c,{size:_.a.MEDIUM,label:s.a.createElement(I.a,{top:8,left:-32,tooltip:"trailing-stop",stringParams:{SYMBOL:O}},i({key:w.a.TRAILING_PERCENT}))},s.a.createElement(L.a,{noMargins:!0,suffix:"%",disabled:o||c||!t,value:g?g.toFixed(q.k):"",onClickClear:n?this.onClickClear:null,onChange:this.onChangeTrailingPercentInput,placeholder:n&&u?i({key:w.a.REMOVE_STOP}):"0.00"})):s.a.createElement(_.c,{size:_.a.MEDIUM,label:s.a.createElement(I.a,{top:8,left:-32,tooltip:"positions-stop-price",stringParams:{SYMBOL:O}},i({key:w.a.STOP_PRICE}))},s.a.createElement(L.a,{noMargins:!0,market:r,disabled:o||c||!t,value:p,onClickClear:n?this.onClickClear:null,onChange:this.onChangeStopPriceInput,placeholder:n&&!u?i({key:w.a.REMOVE_STOP}):"0.0000"}))}render(){const e=this.props,t=e.allIndexPrices,a=e.allMarkets,r=e.closeModal,i=e.isPairOrderDataLoaded,l=e.position,n=l.type,o=l.liquidationPriceMP,c=l.openPriceMP,d=l.pair,p=e.quoteMarket,g=e.stringGetter,u=this.state,O=u.error,b=u.hasInitialStop,P=u.initialTriggerMP,m=u.isLoading,E=u.isTrailingStopOrder,T=u.triggerPriceInputValue,_=u.triggerPriceMP,L=u.trailingPercent,h=u.initialTrailingPercent,M=d.tickDecimals,D=d.baseSymbol,C=o.getNaturalValue().toFixed(M);let N=g({key:w.a.ADD_STOP});b&&(N=E?!h||L&&L.isZero()?g({key:w.a.EDIT_STOP}):g({key:w.a.REMOVE_STOP}):g(P&&!h&&""===T?{key:w.a.REMOVE_STOP}:{key:w.a.EDIT_STOP}));const j=b&&(E?h:!h),A=b&&(E?L&&L.eq(h):_&&P.baseAmount.eq(_.baseAmount)),x=!!O||!_&&!j||A,q=Object(R.a)({pair:d,allMarkets:a,allIndexPrices:t});return s.a.createElement("div",{className:Y.a.editStopModal},s.a.createElement(f.c,null,s.a.createElement(y,{title:N,subtitle:g({key:w.a.EDIT_STOP_MODAL_DESCRIPTION})}),s.a.createElement(k.a,{className:Y.a.toggle,leftLabel:g({key:w.a.STANDARD}),rightLabel:s.a.createElement("div",{className:Y.a.trailingToggleWrapper},s.a.createElement("div",{className:Y.a.trailingToggleLabel},g({key:w.a.TRAILING_STOP_ABBREVIATED}),s.a.createElement(I.a,{shortDelay:!0,className:Y.a.helpIcon,top:12,left:-240,tooltip:"trailing-stop"},"?"))),onClickLeft:this.onClickStandardStop,onClickRight:this.onClickTrailingStop,isToggledRight:E,grayscale:!0}),this.renderInput(),E?s.a.createElement(S.i,{className:Y.a.trailingStopArea},s.a.createElement(S.h,null,s.a.createElement(S.g,{title:s.a.createElement(I.a,{top:12,left:-32,tooltip:"positions-stop-price",stringParams:{SYMBOL:D}},g({key:w.a.STOP_PRICE}))},_?`${_.getNaturalValue().toFixed(M)} ${p.symbol}`:"-")),s.a.createElement(S.h,null,s.a.createElement(S.g,{title:s.a.createElement(I.a,{top:12,left:-140,tooltip:"index-price"},g({key:w.a.INDEX_PRICE}))},q.toFixed(M)," ",p.symbol))):s.a.createElement(S.b,{className:Y.a.indexArea},s.a.createElement(S.g,{title:s.a.createElement(I.a,{top:12,left:-32,tooltip:"index-price"},g({key:w.a.INDEX_PRICE}))},q.toFixed(M)," ",p.symbol)),s.a.createElement(S.i,null,s.a.createElement(S.h,null,s.a.createElement(S.g,{title:s.a.createElement(I.a,{top:12,left:-32,tooltip:"positions-open-price"},g({key:w.a.OPEN_PRICE}))},c.getNaturalValue().toFixed(M)," ",p.symbol)),s.a.createElement(S.h,null,s.a.createElement(S.g,{title:s.a.createElement(I.a,{top:12,left:-108,tooltip:n===v.b.ISOLATED_LONG?"liquidation-price-long":"liquidation-price-short",stringParams:{SYMBOL:D}},g({key:w.a.LIQUIDATION_PRICE_SHORT}))},C," ",p.symbol))),O?s.a.createElement(S.a,null,O):null),s.a.createElement(f.b,null,s.a.createElement(f.a,{onClick:r},g({key:w.a.CANCEL})),s.a.createElement(f.a,{disabled:x||m||!i,onClick:this.onClickCta,green:!0,loading:m||!i},N)))}}H.propTypes={allIndexPrices:d.a.object.isRequired,allMarkets:d.a.array.isRequired,allOrders:d.a.array.isRequired,allPairOrderData:d.a.object.isRequired,baseMarket:d.a.object.isRequired,canBypass28DayRequirement:d.a.bool.isRequired,cancelOrder:d.a.func.isRequired,closeModal:d.a.func.isRequired,isPairOrderDataLoaded:d.a.bool.isRequired,legacySigning:d.a.bool,placeOrder:d.a.func.isRequired,position:d.a.object.isRequired,quoteMarket:d.a.object.isRequired,stringGetter:d.a.func.isRequired,walletAddress:d.a.string,walletType:d.a.string};var X=Object(P.k)(Object(p.c)((e,t)=>{const a=t.position.pair,r=Object(M.f)(e,a.baseMarket),i=Object(M.f)(e,a.quoteMarket);return{allIndexPrices:Object(R.b)(e),allMarkets:Object(M.d)(e),allOrders:Object(C.k)(e),allPairOrderData:Object(j.c)(e),baseMarket:r,canBypass28DayRequirement:Object(N.a)(e),isPairOrderDataLoaded:Object(j.f)(e),legacySigning:Object(D.i)(e),quoteMarket:i,walletAddress:Object(D.m)(e),walletType:Object(D.q)(e)}},e=>Object(g.b)({placeOrder:h.c,cancelOrder:h.a},e))(H));a.d(t,"default",function(){return X})}}]);